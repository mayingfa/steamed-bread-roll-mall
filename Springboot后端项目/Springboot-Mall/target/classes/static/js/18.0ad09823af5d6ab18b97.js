webpackJsonp([18],{"+EVV":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={name:"ProductAdd",data:function(){return{productBrandInfo:"",productTypeInfo:"",productId:"",productForm:{productNo:"",productName:"",productBrand:"",productType:"",productDescribe:"",inPrice:0,outPrice:0,productStock:50,lowestStock:50,isNew:!0,isSale:!0,isStockOut:!1,productUrl:""},productSpec:[],productSpecs:[],productRules:{productName:[{required:!0,message:"请填写商品名称",trigger:"blur"},{min:1,max:30,message:"名称长度不允许超过 30 个字符",trigger:"blur"}],productBrand:[{required:!0,message:"请选择商品品牌",trigger:"blur"}],productType:[{required:!0,message:"请选择商品分类",trigger:"blur"}],productDescribe:[{required:!0,message:"请填写商品介绍",trigger:"blur"},{min:1,max:100,message:"名称长度不允许超过 100 个字符",trigger:"blur"}],productUrl:[{required:!0,message:"请上传商品图片",trigger:"blur"}]}}},methods:{uploadProductUrlSuccess:function(t){200===t.code?(this.$msg.success("商品图片上传成功！"),this.productForm.productUrl=t.data,this.$refs.productUpload.clearFiles()):this.$msg.error("商品图片上传失败！")},getDateNow:function(){var t=this,e=new Date,r=String(e.getFullYear()),o=String(e.getMonth()+1),c=String(e.getDate()),a=String(e.getHours());a.length<2&&(a="0"+a);var s=String(e.getMinutes());s.length<2&&(s="0"+s);var i=String(e.getSeconds());i.length<2&&(i="0"+i),this.$http.post("/product/findCount").then(function(e){if(200===e.data.code){var l=e.data.data;t.productForm.productNo=r+o+c+a+s+i+l}else t.$msg.error(e.data.message)}).catch(function(e){t.$msg.error(e)})},querySpec:function(t){var e=this;this.productSpec.length=0,this.$http.post("/specs/findAllByType?productType="+t).then(function(t){200===t.data.code&&(e.productSpecs=t.data.data)}).catch(function(t){e.$msg.error(t)})},submitForm:function(t){var e=this;this.$refs[t].validate(function(r){if(!r)return!1;e.productForm.productName=e.productForm.productName.trim(),e.productForm.productDescribe=e.productForm.productDescribe.trim();var o=e.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});e.productForm.isStockOut=e.productForm.productStock<e.productForm.lowestStock,e.$http.post("/product/add",e.$qs.stringify(e.productForm)).then(function(r){o.close(),200===r.data.code?(e.$notify({title:"成功",message:e.productForm.productName+"\t添加成功",type:"success"}),e.$refs[t].resetFields(),e.getDateNow(),0!==e.productSpec.length&&(e.productId=null,e.submitSpec(e.productForm.productNo))):e.$notify.error({title:"失败",message:r.data.message})}).catch(function(t){o.close(),e.$msg.error(t)})})},resetForm:function(t){this.getDateNow(),this.$refs[t].resetFields()},sleep:function(t,e){var r=this;setTimeout(function(){r.$http.post("/product/findIdByKey?productNo="+e).then(function(t){200===t.data.code&&(r.productId=t.data.data)}).catch(function(t){r.$msg.error(t)}),null!==r.productId?(r.$http.post("/productSpecs/addBatch?productId="+r.productId+"&specsIds="+r.productSpec),r.productSpec=[]):r.sleep(1e3,e)},t)},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type,r="image/gif"===t.type,o="image/png"===t.type,c="image/bmp"===t.type,a="image/webp"===t.type,s=t.size/1024/1024<5;return e||r||o||c||a?s||this.$msg.error("上传图片大小不能超过 5MB!"):this.$msg.error("仅支持上传 JPG、JPEG、PNG、GIF、BMP、WEBP 格式文件"),(e||r||o||c||a)&&s},submitSpec:function(t){this.sleep(1e3,t)}},created:function(){var t=this;this.$http.post("/productBrand/findAllName").then(function(e){200===e.data.code&&(t.productBrandInfo=e.data.data)}).catch(function(e){t.$msg.error(e)}),this.$http.post("/productType/findAllName").then(function(e){200===e.data.code&&(t.productTypeInfo=e.data.data)}).catch(function(e){t.$msg.error(e)}),this.getDateNow()}},c={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"product-add"},[r("el-card",{staticClass:"product-box",attrs:{shadow:"hover"}},[r("div",{staticStyle:{"text-align":"left"},attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"el-icon-circle-plus-outline"}),t._v(" "),r("span",[t._v("添加商品")])]),t._v(" "),r("div",{staticClass:"info-box"},[r("el-form",{ref:"ruleForm",staticClass:"product-form",attrs:{model:t.productForm,inline:!0,rules:t.productRules}},[r("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"商品名称：",prop:"productName"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{size:"small"},model:{value:t.productForm.productName,callback:function(e){t.$set(t.productForm,"productName",e)},expression:"productForm.productName"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品分类：",prop:"productType"}},[r("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择类别"},on:{change:function(e){return t.querySpec(t.productForm.productType)}},model:{value:t.productForm.productType,callback:function(e){t.$set(t.productForm,"productType",e)},expression:"productForm.productType"}},t._l(t.productTypeInfo,function(t,e){return r("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"商品规格：",prop:"productSpec"}},[r("el-select",{staticClass:"select-spec",staticStyle:{width:"245px"},attrs:{size:"small",multiple:"",placeholder:"请选择商品规格"},model:{value:t.productSpec,callback:function(e){t.productSpec=e},expression:"productSpec"}},t._l(t.productSpecs,function(t){return r("el-option",{key:t.specsId,attrs:{label:t.specsName,value:t.specsId}})}),1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"商品品牌：",prop:"productBrand"}},[r("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择品牌"},model:{value:t.productForm.productBrand,callback:function(e){t.$set(t.productForm,"productBrand",e)},expression:"productForm.productBrand"}},t._l(t.productBrandInfo,function(t,e){return r("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品进价：",prop:"inPrice"}},[r("el-input",{attrs:{min:"0",size:"small",type:"number",placeholder:"商品进价"},model:{value:t.productForm.inPrice,callback:function(e){t.$set(t.productForm,"inPrice",e)},expression:"productForm.inPrice"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品库存：",prop:"productStock"}},[r("el-input-number",{attrs:{size:"small",min:0,max:1e3,placeholder:"商品库存"},model:{value:t.productForm.productStock,callback:function(e){t.$set(t.productForm,"productStock",e)},expression:"productForm.productStock"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品售价：",prop:"outPrice"}},[r("el-input",{attrs:{min:"0",size:"small",type:"number",placeholder:"商品售价"},model:{value:t.productForm.outPrice,callback:function(e){t.$set(t.productForm,"outPrice",e)},expression:"productForm.outPrice"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"最低库存：",prop:"lowestStock"}},[r("el-input-number",{attrs:{size:"small",min:0,max:1e3,placeholder:"最低库存"},model:{value:t.productForm.lowestStock,callback:function(e){t.$set(t.productForm,"lowestStock",e)},expression:"productForm.lowestStock"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"100%",height:"30px"},attrs:{label:"商品状态："}},[r("el-form-item",{staticStyle:{"margin-right":"50px"},attrs:{label:"上架",prop:"isSale"}},[r("el-switch",{model:{value:t.productForm.isSale,callback:function(e){t.$set(t.productForm,"isSale",e)},expression:"productForm.isSale"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"新品",prop:"isNew"}},[r("el-switch",{model:{value:t.productForm.isNew,callback:function(e){t.$set(t.productForm,"isNew",e)},expression:"productForm.isNew"}})],1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品介绍：",prop:"productDescribe"}},[r("el-input",{staticClass:"product-desc",attrs:{type:"textarea",size:"small","show-word-limit":"",autosize:{minRows:1,maxRows:4},placeholder:"商品描述"},model:{value:t.productForm.productDescribe,callback:function(e){t.$set(t.productForm,"productDescribe",e)},expression:"productForm.productDescribe"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"商品图片：",prop:"productUrl"}},[r("el-upload",{ref:"productUpload",staticClass:"product-upload",staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"140px",width:"160px"},attrs:{action:this.$VAR.http+"/uploadImage?name=productImage","on-success":t.uploadProductUrlSuccess,"before-upload":t.beforeAvatarUpload,drag:!0,"list-type":"picture"}},[t.productForm.productUrl?r("el-image",{staticStyle:{height:"140px",width:"160px"},attrs:{src:t.productForm.productUrl}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"100%","text-align":"center",position:"absolute",bottom:"-14px",left:"0"}},[r("el-button",{staticStyle:{margin:"0 55px"},attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("添加商品")]),t._v(" "),r("el-button",{staticStyle:{margin:"0 55px"},on:{click:function(e){return t.resetForm("ruleForm")}}},[t._v("取消重置")])],1)],1)],1)])],1)},staticRenderFns:[]};var a=r("VU/8")(o,c,!1,function(t){r("ZCg6")},null,null);e.default=a.exports},ZCg6:function(t,e){}});
//# sourceMappingURL=18.0ad09823af5d6ab18b97.js.map